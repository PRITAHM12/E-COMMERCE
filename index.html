<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RAJ ELECTRIC AND ELECTRONICS</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Poppins:wght@600;800&display=swap" rel="stylesheet">

  <meta name="description" content="RAJ ELECTRIC - accessible, high-contrast catalog with improved header and dark menu, full product set, detailed checkout and post-order payment options" />
  <style>
    :root{
      --page-bg: #071328;
      --surface: #ffffff;
      --muted-ink: #6b7280;
      --text-on-surface: #082033;
      --accent: #0b71ff;
      --brand-accent: #ffd166;
      --menu-bg: #041226;
      --menu-text: #e6f0fb;
      --menu-muted: #98a7b8;
      --radius:12px;
      --shadow-lg: 0 18px 40px rgba(2,6,23,0.25);
      --max-w:1200px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color: #cbd5e1;
    }

    html,body{ height:100%; margin:0; background: linear-gradient(180deg,var(--page-bg), #03203b); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    a{ color:inherit; text-decoration:none; }

    .top-left-menu-btn {
      position: fixed; left:16px; top:16px; z-index:220;
      width:56px; height:56px; border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04); cursor:pointer;
    }
    .top-left-menu-btn svg{ width:22px; height:22px; color:#fff; }

    .drawer-overlay{ position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:210; display:none; }
    .drawer{
      position:fixed; left:18px; top:18px; height:calc(100vh - 36px); width:340px; max-width:calc(100% - 36px);
      background: linear-gradient(180deg,var(--menu-bg), rgba(4,18,38,0.96));
      color:var(--menu-text);
      border-radius:12px; padding:18px; box-shadow: 0 30px 60px rgba(2,6,23,0.6);
      border:1px solid rgba(255,255,255,0.04); z-index:220; transform: translateX(-8px); opacity:0; pointer-events:none; transition: transform .22s,opacity .18s;
      display:flex; flex-direction:column; gap:12px; overflow:auto;
    }
    .drawer.open{ transform: translateX(0); opacity:1; pointer-events:auto; }
    .drawer h4{ margin:0 0 6px 0; color:var(--menu-text); font-family:Poppins, Inter, sans-serif; font-weight:700; font-size:18px; }
    .menu-section{ display:flex; flex-direction:column; gap:8px; margin-bottom:6px; }
    .menu-item{
      display:flex; gap:12px; align-items:center; padding:12px; border-radius:10px; cursor:pointer;
      background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      color:var(--menu-text); border:1px solid rgba(255,255,255,0.03);
    }
    .menu-item .icon { width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.03); color:var(--brand-accent); font-weight:700; }
    .menu-item .meta{ font-size:12px; color:var(--menu-muted); }
    .menu-item:hover{ transform:translateX(6px); transition:transform .12s; background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); }

    .help-panel{
      margin-top:8px; padding:12px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03); color:var(--menu-text);
    }
    .help-panel h5{ margin:0 0 8px 0; color:var(--menu-text); font-size:14px; }
    .help-panel p{ margin:0; color:var(--menu-muted); font-size:13px; }

    header.header{
      position: relative; margin:18px 22px 0 96px; display:flex; align-items:center; gap:18px; padding:14px 18px; border-radius:12px;
      background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); z-index:120;
      backdrop-filter: blur(2px);
    }
    .brand{ display:flex; gap:14px; align-items:center; cursor:pointer; min-width:260px; }
    .brand .logo{ width:72px; height:72px; border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center; box-shadow:0 14px 36px rgba(11,113,255,0.10); background: linear-gradient(135deg,#0b71ff,#06b6d4); }
    .brand .title .name{ font-family:Poppins, Inter, sans-serif; font-weight:800; color:#ffffff; font-size:20px; letter-spacing:0.2px; text-shadow:0 2px 8px rgba(3,16,28,0.45); }
    .brand .title .tag{ font-size:12px; color:#dbeaf7; opacity:0.95; }

    .search{ flex:1; display:flex; align-items:center; gap:12px; }
    .search input{ width:100%; padding:12px 14px; border-radius:10px; border:1px solid rgba(2,8,23,0.06); background:#fff; color:var(--text-on-surface); font-size:14px; }

    .header-actions{ display:flex; gap:10px; align-items:center; margin-left:auto; }
    .icon-btn{ width:46px; height:46px; display:flex; align-items:center; justify-content:center; border-radius:10px; background:#ffffff; border:1px solid rgba(2,8,23,0.06); color:var(--text-on-surface); cursor:pointer; box-shadow:0 6px 18px rgba(2,6,23,0.06); }
    .icon-btn:hover{ transform:translateY(-2px); transition:transform .12s; }

    .avatar{ width:44px; height:44px; border-radius:8px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:#f3f7fb; border:1px solid rgba(2,8,23,0.04); }
    .avatar img{ width:100%; height:100%; object-fit:cover; }

    main.container{ max-width: var(--max-w); margin:28px auto 48px; padding:0 20px; }
    .hero{ display:flex; gap:24px; align-items:center; padding:22px; border-radius:12px; background: linear-gradient(90deg, rgba(255,255,255,0.98), rgba(245,250,255,0.96)); color: var(--text-on-surface); box-shadow: 0 12px 36px rgba(2,6,23,0.08); }
    .hero-left h1{ margin:0; font-family:Poppins, Inter, sans-serif; font-size:28px; color:var(--text-on-surface); }
    .grid-wrap{ margin-top:20px; display:flex; gap:20px; }
    .left-panel{ width:300px; min-width:220px; background: #062133; border-radius:12px; padding:14px; border:1px solid rgba(255,255,255,0.03); color:var(--muted-ink); }
    .product-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:18px; margin-top:12px; }
    .product-card{ background: var(--surface); color: var(--text-on-surface); border-radius:12px; padding:12px; box-shadow:var(--shadow-lg); display:flex; flex-direction:column; gap:10px; min-height:260px; border:1px solid rgba(2,8,23,0.06); }
    .thumb{ height:180px; border-radius:10px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:#f6f8fa; }
    .thumb img{ max-width:100%; max-height:100%; object-fit:contain; display:block; }
    .product-title{ font-weight:700; font-size:15px; color:var(--text-on-surface); margin-bottom:6px; }
    .product-meta{ color:var(--muted-ink); font-size:13px; }
    .product-price{ color:var(--accent); font-weight:800; }
    .card-actions{ display:flex; gap:8px; margin-top:auto; }
    .btn{ flex:1; padding:10px; border-radius:10px; border:none; cursor:pointer; font-weight:600; font-size:14px; }
    .btn-outline{ background:#fff; border:1px solid rgba(2,8,23,0.06); color:var(--text-on-surface); }
    .btn-primary{ background:var(--accent); color:#fff; }

    footer{ color:rgba(234,246,255,0.65); text-align:center; margin-top:36px; padding-bottom:30px; }

    @media (max-width:980px){
      header.header{ margin:12px 12px 0 12px; flex-wrap:wrap; }
      .top-left-menu-btn{ left:12px; top:12px; }
      .drawer{ left:12px; top:12px; width:calc(100% - 24px); height:calc(100vh - 24px); }
      main.container{ margin:20px 12px 36px; padding:0 12px; }
      .grid-wrap{ flex-direction:column; }
      .left-panel{ width:100%; order:2; }
      .brand .logo{ width:56px; height:56px; }
      .brand .title .name{ font-size:16px; }
    }
  </style>
</head>
<body>

  <!-- Menu button -->
  <button id="uxMenuBtn" class="top-left-menu-btn" aria-label="Open menu" title="Menu">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M3 6h18M3 12h18M3 18h18" stroke="#ffffff"/>
    </svg>
  </button>

  <!-- Drawer overlay -->
  <div id="uxDrawerOverlay" class="drawer-overlay" aria-hidden="true"></div>

  <!-- Drawer -->
  <aside id="uxDrawer" class="drawer" role="navigation" aria-label="Site menu" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h4>Menu</h4>
      <button id="menuClose" style="background:transparent;border:none;color:var(--menu-text);cursor:pointer;font-weight:700">Close</button>
    </div>

    <div class="menu-section" role="menu" aria-label="Primary menu">
      <div class="menu-item" data-action="categories" role="menuitem" tabindex="0">
        <div class="icon">C</div>
        <div>
          <div style="font-weight:700">All categories</div>
          <div class="meta">Browse product categories</div>
        </div>
      </div>

      <div class="menu-item" data-action="orders" role="menuitem" tabindex="0">
        <div class="icon">O</div>
        <div>
          <div style="font-weight:700">My orders</div>
          <div class="meta">View placed orders & cancel</div>
        </div>
      </div>

      <div class="menu-item" data-action="cart" role="menuitem" tabindex="0">
        <div class="icon">Ct</div>
        <div>
          <div style="font-weight:700">My cart</div>
          <div class="meta">Open cart</div>
        </div>
      </div>

      <div class="menu-item" data-action="account" role="menuitem" tabindex="0">
        <div class="icon">A</div>
        <div>
          <div style="font-weight:700">My account</div>
          <div class="meta">Profile & settings</div>
        </div>
      </div>

      <div class="menu-item" data-action="help" role="menuitem" tabindex="0">
        <div class="icon">?</div>
        <div>
          <div style="font-weight:700">Help centre</div>
          <div class="meta">Open detailed help and contact options</div>
        </div>
      </div>
    </div>

    <div style="height:1px;background:rgba(255,255,255,0.02);margin:6px 0"></div>

    <div id="drawerHelpPanel" class="help-panel" aria-hidden="true" style="display:none">
      <h5>Help centre</h5>
      <p id="helpIntro">Need help? Use the actions below to contact support or view FAQs.</p>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="openFaq" class="btn btn-outline" style="background:transparent;color:var(--menu-text);border:1px solid rgba(255,255,255,0.06)">FAQs</button>
        <button id="contactOwner" class="btn btn-primary" style="background:var(--brand-accent);color:#072033">Contact owner</button>
      </div>

      <div id="helpContact" style="margin-top:12px;color:var(--menu-muted);display:none">
        <div style="font-weight:700;color:var(--menu-text)">Owner / Support</div>
        <div style="margin-top:6px">Phone: <strong style="color:var(--menu-text)">9534100325</strong></div>
        <div style="margin-top:4px">WhatsApp: <strong style="color:var(--menu-text)">9534100325, 6200264347</strong></div>
        <div style="margin-top:4px">Email: <strong style="color:var(--menu-text)">pritahmraj9935@gmail.com</strong></div>
      </div>
    </div>
  </aside>

  <!-- Header (updated brand look) -->
  <header class="header" role="banner" aria-label="Main header">
    <div class="brand" onclick="location.hash='/'" role="link" tabindex="0">
      <div class="logo" aria-hidden="true">
        <svg width="72" height="72" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <linearGradient id="g1b" x1="0" x2="1">
              <stop offset="0" stop-color="#ffd166"/>
              <stop offset="1" stop-color="#ff6b6b"/>
            </linearGradient>
            <linearGradient id="g2b" x1="0" x2="1">
              <stop offset="0" stop-color="#6ee7b7"/>
              <stop offset="1" stop-color="#0b71ff"/>
            </linearGradient>
          </defs>
          <rect width="120" height="120" rx="18" fill="url(#g2b)"/>
          <circle cx="84" cy="30" r="20" fill="url(#g1b)"/>
          <text x="28" y="82" font-family="Poppins,Inter,Arial" font-size="54" fill="#ffffff" font-weight="800">R</text>
        </svg>
      </div>
      <div class="title" style="margin-left:10px">
        <div class="name">RAJ ELECTRIC</div>
        <div class="tag">Electrical components & supplies</div>
      </div>
    </div>

    <div class="search" role="search" aria-label="Search products">
      <input id="uxSearch" placeholder="Search products, brands, categories" aria-label="Search products" />
    </div>

    <div class="header-actions" role="toolbar" aria-label="Header actions">
      <button id="uxNotifBtn" class="icon-btn" title="Notifications" aria-haspopup="true" aria-expanded="false" aria-label="Notifications">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M15 17h5l-1.4-1.4A2 2 0 0 1 18 14.6V11a6 6 0 1 0-12 0v3c0 .5-.2 1.1-.6 1.4L4 17h5"/></svg>
      </button>

      <button id="uxOpenCart" class="icon-btn" title="Open cart" aria-label="Open cart">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 6h14l-1.5 9h-11z"/></svg>
      </button>

      <div class="avatar" title="Account">
        <button id="uxAvatarBtn" style="all:unset;cursor:pointer" aria-haspopup="true" aria-label="Open account">
          <img id="uxAvatarImg" src="" alt="Account avatar" />
        </button>
      </div>
    </div>
  </header>

  <!-- Main container -->
  <main class="container" id="app" role="main" aria-live="polite">
    <!-- Hero -->
    <section class="hero" aria-label="Hero">
      <div class="hero-left">
        <h1>Electrical goods built for professionals and stores</h1>
        <div style="margin-top:12px;display:flex;gap:10px">
          <button id="uxShopNow" class="btn btn-primary" style="background:var(--accent); color:#fff; padding:10px 14px; border-radius:10px; border:none;">Shop now</button>
          <button id="uxHow" class="btn btn-outline" style="background:#fff; color:var(--text-on-surface); border:1px solid rgba(2,8,23,0.06);">How it works</button>
        </div>
      </div>
      <div style="width:420px; display:flex; align-items:center; justify-content:center;">
        <img alt="RAJ hero" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='840' height='520'><rect width='100%25' height='100%25' rx='16' fill='%230b71ff'/><text x='50%25' y='50%25' font-family='Poppins,Arial' font-size='36' fill='white' text-anchor='middle' dominant-baseline='middle'>RAJ ELECTRIC</text></svg>" style="width:100%; border-radius:12px; box-shadow:0 18px 40px rgba(11,113,255,0.14);" />
      </div>
    </section>

    <!-- Grid -->
    <div class="grid-wrap">
      <!-- Left panel -->
      <aside class="left-panel" aria-label="Filters and admin">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700;color:var(--surface)">Filters</div>
          <div id="countProducts" style="font-size:13px;color:var(--muted-ink)">0 products</div>
        </div>

        <label>Category
          <select id="filterCategory"></select>
        </label>

        <label>Brand
          <input id="filterBrand" placeholder="Brand name" />
        </label>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="applyFilters" class="btn btn-primary" style="background:var(--accent); color:#fff;">Apply</button>
          <button id="resetFilters" class="btn btn-outline" style="background:#fff; color:var(--text-on-surface);">Reset</button>
        </div>

        <div style="margin-top:14px; display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-size:13px;color:var(--muted-ink)">Admin</div>
            <div style="font-size:12px;color:var(--muted-ink)">Local admin panel</div>
          </div>
          <div><button id="openAdminQuick" class="btn btn-outline" style="background:#fff;">Open</button></div>
        </div>
      </aside>

      <!-- Products -->
      <section class="main-area" aria-label="Products">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2 style="margin:0;color:var(--surface)">Products</h2>
        </div>

        <div id="productGrid" class="product-grid" role="list" aria-live="polite"></div>
      </section>
    </div>
  </main>

  <!-- Floating cart -->
  <div id="uxCartPanel" style="position:fixed; right:20px; bottom:20px; width:380px; background:var(--surface); color:var(--text-on-surface); border-radius:12px; box-shadow:0 20px 50px rgba(2,6,23,0.28); padding:12px; display:none; z-index:230;" role="dialog" aria-label="Cart">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Cart</strong>
      <div style="display:flex;gap:8px">
        <button id="uxCheckoutBtn" class="btn btn-primary" style="background:var(--accent); color:#fff; padding:8px 12px;">Checkout</button>
        <button id="uxCloseCart" class="btn btn-outline" style="background:#fff;">Close</button>
      </div>
    </div>
    <div id="uxCartContent" style="margin-top:10px; max-height:320px; overflow:auto;"></div>
    <div style="display:flex;justify-content:space-between;margin-top:10px;"><div style="color:#6b7280">Subtotal</div><div id="uxCartSub" style="font-weight:800">₹0</div></div>
  </div>

  <footer style="margin-top:36px;text-align:center;color:rgba(234,246,255,0.65);padding-bottom:30px">© RAJ ELECTRIC AND ELECTRONICS</footer>

  <script>
    /* Keys and lists */
    const CART_KEY = 'raj_cart_v1';
    const ORDER_KEY = 'raj_orders_v1';
    const AUTH_KEY = 'raj_auth_v1';

    const CATEGORIES = ['Voltage Regulators','Batteries','Inverters','Adapters','Cables','LED Bulbs','LED Tubes','Drivers','Fittings','Switches','Meters','Sensors','Tools','Headphones','Earphones','Datacables','Power Banks','Chargers','Surge Protectors','Extension Cords','Sockets','Connectors','Transformers','Relays','Industrial Lamps'];
    const BRANDS = ['RAJ','Energize','VoltPro','PowerX','LiteMax','DynoTech','Apex','Nova','ElectroHub','Prime','SoundWave','BassLab','CableCore','ChargePro','BrightLine'];

    /* Local storage helpers */
    function loadCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); } catch(e){ return []; } }
    function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); renderCartPanel(); }
    function loadOrders(){ try { return JSON.parse(localStorage.getItem(ORDER_KEY) || '[]'); } catch(e) { return []; } }
    function saveOrders(o){ localStorage.setItem(ORDER_KEY, JSON.stringify(o)); }
    function accountSave(p){ localStorage.setItem(AUTH_KEY, JSON.stringify(p)); refreshAvatar(); }
    function accountLoad(){ try { return JSON.parse(localStorage.getItem(AUTH_KEY) || 'null'); } catch(e){ return null; } }
    function accountLogout(){ localStorage.removeItem(AUTH_KEY); refreshAvatar(); }

    /* Utilities */
    function slugify(s){ return (s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
    function escapeXml(s){ return String(s||'').replace(/[&<>'"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&apos;','"':'&quot;'})[c]); }
    function placeholderImage(text, idx){
      const bg = ['#eef2ff','#ecfeff','#fff7ed'][idx%3];
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='900'><rect width='100%' height='100%' fill='${bg}'/><text x='50%' y='48%' font-family='Inter,Arial' font-size='48' fill='#082033' text-anchor='middle' dominant-baseline='middle'>${escapeXml(text)}</text></svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    /* Bulk product generator (keeps previous behaviour) */
    function generateProducts(count=1520){
      const items = [];
      for(let i=1;i<=count;i++){
        const category = CATEGORIES[i % CATEGORIES.length];
        const brand = BRANDS[i % BRANDS.length];
        const title = `${brand} ${category} Model ${1000 + i}`;
        items.push({
          _id: 'p' + i,
          title,
          slug: slugify(title),
          description: `High quality ${title} by ${brand}. Durable and reliable.`,
          price: Math.round((Math.random()*14800) + 200),
          images: [placeholderImage(title, i)],
          category, brand, sku: 'SKU' + (10000 + i),
          rating: Number((Math.random()*2 + 3).toFixed(1)),
          createdAt: new Date().toISOString()
        });
      }
      return items;
    }

    async function loadProductsJsonSafe(){
      try {
        const res = await fetch('./products_with_images_with_repo_images.json', { cache: 'no-store' });
        if(!res.ok) throw new Error('no file');
        const data = await res.json();
        window.PRODUCTS = Array.isArray(data) ? data : generateProducts(1520);
      } catch (err) {
        window.PRODUCTS = generateProducts(1520);
      }
    }

    /* Drawer & header wiring */
    const uxMenuBtn = document.getElementById('uxMenuBtn');
    const uxDrawer = document.getElementById('uxDrawer');
    const uxOverlay = document.getElementById('uxDrawerOverlay');
    const menuClose = document.getElementById('menuClose');

    function openDrawer(){ uxDrawer.classList.add('open'); uxDrawer.setAttribute('aria-hidden','false'); uxOverlay.style.display='block'; }
    function closeDrawer(){ uxDrawer.classList.remove('open'); uxDrawer.setAttribute('aria-hidden','true'); uxOverlay.style.display='none'; }

    uxMenuBtn.addEventListener('click', () => { openDrawer(); });
    uxOverlay.addEventListener('click', () => { closeDrawer(); });
    menuClose.addEventListener('click', () => { closeDrawer(); });

    uxDrawer.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', (e) => {
        const act = item.getAttribute('data-action');
        if(act === 'help'){
          const helpPanel = document.getElementById('drawerHelpPanel');
          const visible = helpPanel.style.display !== 'block';
          helpPanel.style.display = visible ? 'block' : 'none';
          helpPanel.setAttribute('aria-hidden', visible ? 'false' : 'true');
          return;
        }
        closeDrawer();
        switch(act){
          case 'categories': alert('Categories:\\n' + CATEGORIES.join('\\n')); break;
          case 'orders': location.hash = '/account/orders'; break;
          case 'cart': location.hash = '/cart'; break;
          case 'account': location.hash = '/account/profile'; break;
          default: break;
        }
      });
      item.addEventListener('keydown', (ev) => { if(ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); item.click(); } });
    });

    document.getElementById('openFaq').addEventListener('click', () => {
      alert('FAQs (demo):\\n- How to order\\n- Shipping\\n- Returns');
    });
    document.getElementById('contactOwner').addEventListener('click', () => {
      document.getElementById('helpContact').style.display = 'block';
    });

    /* Notifications & avatar */
    const uxNotifBtn = document.getElementById('uxNotifBtn');
    function showNotifications(){ const list = ['Welcome to RAJ ELECTRIC demo','New arrivals added']; alert('Notifications:\\n' + list.join('\\n')); }
    uxNotifBtn.addEventListener('click', showNotifications);

    function refreshAvatar(){
      const p = accountLoad();
      const img = document.getElementById('uxAvatarImg');
      if(!img) return;
      if(p && p.avatar) img.src = p.avatar;
      else img.src = 'data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="7" r="3" fill="#082033"/><path d="M4 20c0-3.31 2.69-6 6-6s6 2.69 6 6" stroke="#082033" stroke-width="1.2" fill="none"/></svg>');
    }
    document.getElementById('uxAvatarBtn').addEventListener('click', () => { location.hash = '/account/profile'; });

    /* Cart panel render */
    function renderCartPanel(){
      const panel = document.getElementById('uxCartPanel');
      const content = document.getElementById('uxCartContent');
      const sub = document.getElementById('uxCartSub');
      const cart = loadCart();
      if(!panel || !content) return;
      if(cart.length === 0){
        content.innerHTML = '<div style="padding:12px;color:#6b7280">Your cart is empty</div>';
        sub.innerText = '₹0';
        panel.style.display = 'block';
        return;
      }
      content.innerHTML = '';
      let total = 0;
      cart.forEach(it => {
        total += (it.price || 0) * it.qty;
        const row = document.createElement('div');
        row.style.display = 'flex';
        row.style.justifyContent = 'space-between';
        row.style.padding = '10px 0';
        row.style.borderBottom = '1px solid rgba(2,8,23,0.04)';
        row.innerHTML = `<div style="flex:1"><div style="font-weight:700">${it.title}</div><div style="color:#6b7280">₹${it.price}</div></div><div style="text-align:right">Qty ${it.qty}<div style="margin-top:6px">₹${(it.price || 0)*it.qty}</div></div>`;
        content.appendChild(row);
      });
      sub.innerText = '₹' + total;
      panel.style.display = 'block';
    }

    document.getElementById('uxOpenCart').addEventListener('click', () => renderCartPanel());
    document.getElementById('uxCloseCart').addEventListener('click', () => { document.getElementById('uxCartPanel').style.display = 'none'; });
    document.getElementById('uxCheckoutBtn').addEventListener('click', () => {
      // Move to shipping / checkout address page (payment flow starts after order created)
      location.hash = '/payment';
    });

    /* Router & renderers */
    function currentRouteFromHash(){ const h = location.hash || '#/'; return h.startsWith('#') ? h.slice(1) : h; }
    function renderRoute(){
      const path = currentRouteFromHash();
      if(path === '/' || path.startsWith('/?')) { const params = new URLSearchParams(location.hash.split('?')[1] || ''); const q = params.get('q') || ''; return renderHome({ q }); }
      if(path.startsWith('/product/')) return renderProduct(path.replace('/product/',''));
      if(path === '/cart') return renderCartPage();
      if(path === '/payment') return renderPayment();                  // collect full address -> place order
      if(path.startsWith('/payment-options/')) return renderPaymentOptions(path.replace('/payment-options/','')); // shown only after order created
      if(path.startsWith('/order-success/')) return renderOrderSuccess(path.replace('/order-success/',''));
      if(path === '/admin') return renderAdmin();
      if(path.startsWith('/account')) return renderAccount(path.replace('/account/','') || 'profile');
      if(path.startsWith('/order/')) return renderOrderDetail(path.replace('/order/',''));
      renderNotFound();
    }

    /* Home rendering (unchanged) */
    function renderHome(opts = {}){
      const q = (opts.q || '').toLowerCase();
      const grid = document.getElementById('productGrid');
      const count = document.getElementById('countProducts');
      const products = (window.PRODUCTS || []).filter(p => {
        if(q) return (p.title + ' ' + p.brand + ' ' + (p.category || '')).toLowerCase().includes(q);
        return true;
      });

      const sel = document.getElementById('filterCategory');
      if(sel && sel.options.length === 0){
        const frag = document.createDocumentFragment();
        const opt = document.createElement('option'); opt.value=''; opt.textContent='All'; frag.appendChild(opt);
        CATEGORIES.forEach(c => { const o = document.createElement('option'); o.textContent = c; frag.appendChild(o); });
        sel.appendChild(frag);
      }

      count.innerText = products.length + ' products';
      grid.innerHTML = '';
      products.forEach((p, idx) => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <a href="#/product/${p.slug}" data-link="#/product/${p.slug}" style="display:block;color:inherit">
            <div class="thumb"><img loading="lazy" src="${(p.images && p.images[0]) || ''}" alt="${escapeXml(p.title)}" /></div>
            <div style="margin-top:8px">
              <div class="product-title">${escapeXml(p.title)}</div>
              <div class="product-meta">${escapeXml(p.brand)} • ${escapeXml(p.category || '')}</div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
              <div class="product-price">₹${p.price}</div>
              <div style="color:#6b7280;font-size:13px">★ ${p.rating}</div>
            </div>
          </a>
          <div class="card-actions">
            <button class="btn btn-outline icon-add" data-id="${p._id}">Add</button>
            <button class="btn btn-primary" data-link="#/product/${p.slug}">View</button>
          </div>
        `;
        grid.appendChild(card);
      });

      grid.querySelectorAll('.icon-add').forEach(b => b.addEventListener('click', () => {
        const id = b.getAttribute('data-id');
        const p = (window.PRODUCTS || []).find(x => x._id === id);
        if(!p) return alert('Product not found');
        const c = loadCart();
        const found = c.find(i => i.productId === id);
        if(found) found.qty = Math.min(999, found.qty + 1); else c.push({ productId: id, title: p.title, price: p.price, image: p.images[0], qty: 1 });
        saveCart(c);
        renderCartPanel();
      }));

      document.getElementById('applyFilters').onclick = () => {
        const cat = document.getElementById('filterCategory').value || '';
        const brand = document.getElementById('filterBrand').value.trim().toLowerCase() || '';
        const list = (window.PRODUCTS || []).filter(p => {
          if(cat && p.category !== cat) return false;
          if(brand && !((p.brand||'').toLowerCase().includes(brand))) return false;
          return true;
        });
        grid.innerHTML = '';
        list.forEach(p => {
          const card = document.createElement('div');
          card.className = 'product-card';
          card.innerHTML = `
            <a href="#/product/${p.slug}" data-link="#/product/${p.slug}" style="display:block;color:inherit">
              <div class="thumb"><img loading="lazy" src="${(p.images && p.images[0]) || ''}" alt="${escapeXml(p.title)}" /></div>
              <div style="margin-top:8px">
                <div class="product-title">${escapeXml(p.title)}</div>
                <div class="product-meta">${escapeXml(p.brand)} • ${escapeXml(p.category || '')}</div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
                <div class="product-price">₹${p.price}</div>
                <div style="color:#6b7280;font-size:13px">★ ${p.rating}</div>
              </div>
            </a>
            <div class="card-actions">
              <button class="btn btn-outline icon-add" data-id="${p._id}">Add</button>
              <button class="btn btn-primary" data-link="#/product/${p.slug}">View</button>
            </div>
          `;
          grid.appendChild(card);
        });
        grid.querySelectorAll('.icon-add').forEach(b => b.addEventListener('click', () => {
          const id = b.getAttribute('data-id');
          const p = (window.PRODUCTS || []).find(x => x._id === id);
          if(!p) return alert('Product not found');
          const c = loadCart();
          const found = c.find(i => i.productId === id);
          if(found) found.qty = Math.min(999, found.qty + 1); else c.push({ productId: id, title: p.title, price: p.price, image: p.images[0], qty: 1 });
          saveCart(c);
          renderCartPanel();
        }));
      };

      document.getElementById('resetFilters').onclick = () => { document.getElementById('filterCategory').value = ''; document.getElementById('filterBrand').value = ''; renderRoute(); };
    }

    /* Product page */
    function renderProduct(slug){
      const product = (window.PRODUCTS || []).find(p => p.slug === slug);
      if(!product) return renderNotFound();
      const mainArea = document.querySelector('.main-area');
      mainArea.innerHTML = `
        <div style="display:flex;gap:22px;flex-wrap:wrap">
          <div style="flex:0 0 48%">
            <div style="background:var(--surface);padding:12px;border-radius:12px">
              <img src="${product.images[0]}" alt="${escapeXml(product.title)}" style="width:100%;height:420px;object-fit:contain;border-radius:8px" />
            </div>
          </div>
          <div style="flex:1">
            <h2 style="margin:0;color:var(--text-on-surface)">${escapeXml(product.title)}</h2>
            <div style="color:#6b7280;margin-top:8px">${escapeXml(product.brand)} • ${escapeXml(product.category || '')}</div>
            <div style="margin-top:14px;background:#f6f8fa;padding:12px;border-radius:10px;display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:800;color:var(--accent);font-size:22px">₹${product.price}</div>
                <div style="color:#6b7280;margin-top:6px">SKU: ${product.sku}</div>
              </div>
              <div style="display:flex;gap:10px">
                <button id="addToCartBtn" class="btn btn-primary">Add to cart</button>
                <button id="buyNowBtn" class="btn btn-outline" style="background:#fff;">Buy now</button>
              </div>
            </div>
            <div style="margin-top:12px;color:#6b7280">${escapeXml(product.description || '')}</div>
          </div>
        </div>
      `;
      document.getElementById('addToCartBtn').addEventListener('click', () => {
        const c = loadCart();
        const found = c.find(i => i.productId === product._id);
        if(found) found.qty = Math.min(999, found.qty + 1); else c.push({ productId: product._id, title: product.title, price: product.price, image: product.images[0], qty: 1 });
        saveCart(c); renderCartPanel();
      });
      document.getElementById('buyNowBtn').addEventListener('click', () => {
        const c = loadCart();
        const found = c.find(i => i.productId === product._id);
        if(found) found.qty = Math.min(999, found.qty + 1); else c.push({ productId: product._id, title: product.title, price: product.price, image: product.images[0], qty: 1 });
        saveCart(c);
        location.hash = '/payment';
      });
    }

    /* Cart page */
    function renderCartPage(){
      const mainArea = document.querySelector('.main-area');
      const cart = loadCart();
      if(!mainArea) return;
      if(cart.length === 0){ mainArea.innerHTML = `<div style="background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface)"><h3>Cart</h3><div style="color:#6b7280">Your cart is empty</div></div>`; return; }
      let total = 0;
      const itemsHtml = cart.map(it => { total += it.price * it.qty; return `<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(2,8,23,0.04)">${it.title} x ${it.qty}<div>₹${it.price * it.qty}</div></div>`; }).join('');
      mainArea.innerHTML = `<div style="background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface)"><h3>Cart</h3>${itemsHtml}<div style="text-align:right;margin-top:10px"><strong>Total ₹${total}</strong></div><div style="text-align:right;margin-top:12px"><button id="cartCheckoutBtn" class="btn btn-primary" style="background:var(--accent);color:#fff;">Checkout</button></div></div>`;
      document.getElementById('cartCheckoutBtn').addEventListener('click', () => location.hash = '/payment');
    }

    /* PAYMENT / Checkout: collect complete address and place order.
       After order is created, redirect to payment-options/:orderId where payment method (COD) is selected.
    */
    function renderPayment(){
      const mainArea = document.querySelector('.main-area');
      const cart = loadCart();
      if(!mainArea) return;
      if(cart.length === 0){ mainArea.innerHTML = `<div style="padding:20px;color:#6b7280">Cart is empty</div>`; return; }

      const subtotal = cart.reduce((s, it) => s + (it.price || 0) * it.qty, 0);
      const profile = accountLoad();

      mainArea.innerHTML = `
        <div style="display:flex;gap:18px;flex-wrap:wrap">
          <div style="flex:1;min-width:420px;background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface)">
            <h3>Shipping and contact information</h3>

            <label style="display:block;margin-top:8px">Full name<input id="payName" value="${profile ? (profile.name || '') : ''}" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label>

            <label style="display:block;margin-top:8px">Mobile number<input id="payPhone" value="${profile ? (profile.phone || '') : ''}" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label>

            <label style="display:block;margin-top:8px">Alternative mobile number<input id="payAltPhone" placeholder="Optional" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label>

            <label style="display:block;margin-top:8px">Address (house / building / road)<textarea id="payAddress" placeholder="House, building, road" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)"></textarea></label>

            <label style="display:block;margin-top:8px">Landmark<input id="payLandmark" placeholder="Landmark" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label>

            <div style="display:flex;gap:8px;margin-top:8px">
              <label style="flex:1">City<input id="payCity" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label>
              <label style="flex:1">State<input id="payState" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label>
            </div>

            <div style="display:flex;gap:8px;margin-top:8px">
              <label style="flex:1">Country<input id="payCountry" value="India" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label>
              <label style="flex:1">Pin code<input id="payPin" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
              <button id="placeOrderBtn_temp" class="btn btn-primary" style="background:var(--accent);color:#fff;">Place order</button>
              <button id="cancelCheckout" class="btn btn-outline" style="background:#fff;">Cancel</button>
            </div>
          </div>

          <div style="width:420px;background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface)">
            <h3>Order summary</h3>
            <div style="max-height:340px;overflow:auto">${cart.map(it => `<div style="display:flex;justify-content:space-between;padding:6px 0">${it.title} x ${it.qty}<div>₹${it.price * it.qty}</div></div>`).join('')}</div>
            <div style="display:flex;justify-content:space-between;margin-top:8px"><div style="color:#6b7280">Subtotal</div><div style="font-weight:800">₹${subtotal}</div></div>
            <div style="margin-top:12px;color:#6b7280;font-size:13px">After you place the order, you will be taken to payment options. Select Cash on Delivery or other methods there.</div>
          </div>
        </div>
      `;

      document.getElementById('cancelCheckout').addEventListener('click', () => { location.hash = '/cart'; });
      document.getElementById('placeOrderBtn_temp').addEventListener('click', () => {
        // validate required fields
        const name = document.getElementById('payName').value.trim();
        const phone = document.getElementById('payPhone').value.trim();
        const city = document.getElementById('payCity').value.trim();
        const state = document.getElementById('payState').value.trim();
        const country = document.getElementById('payCountry').value.trim();
        const pin = document.getElementById('payPin').value.trim();
        const address = document.getElementById('payAddress').value.trim();
        if(!name || !phone || !city || !state || !country || !pin || !address) return alert('Please fill name, phone, address, city, state, country and pin code');

        // create order immediately (order placed) with status 'pending_payment'
        const orders = loadOrders();
        const id = 'ORD' + Date.now().toString(36).toUpperCase();
        const cartItems = loadCart();
        const subtotal = cartItems.reduce((s, it) => s + (it.price || 0) * it.qty, 0);
        const order = {
          id,
          items: cartItems,
          total: subtotal,
          shippingAddress: {
            name,
            phone,
            altPhone: document.getElementById('payAltPhone').value.trim() || '',
            address,
            landmark: document.getElementById('payLandmark').value.trim() || '',
            city,
            state,
            country,
            pin
          },
          paymentStatus: 'pending',      // payment not confirmed yet
          orderStatus: 'placed',
          createdAt: new Date().toISOString()
        };
        orders.unshift(order);
        saveOrders(orders);

        // clear cart but keep a reference to order id — cart emptied after placing order
        saveCart([]);

        // redirect to payment options page for this order
        location.hash = '/payment-options/' + id;
      });
    }

    /* PAYMENT OPTIONS page: shown only after order created */
    function renderPaymentOptions(orderId){
      const mainArea = document.querySelector('.main-area');
      const orders = loadOrders();
      const ord = orders.find(o => o.id === orderId);
      if(!ord) { renderNotFound(); return; }
      // show payment options and confirm
      mainArea.innerHTML = `
        <div style="background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface);max-width:900px;margin:0 auto">
          <h3>Payment options for order ${ord.id}</h3>
          <div style="margin-top:8px;color:#6b7280">Total: <strong>₹${ord.total}</strong></div>

          <div style="margin-top:14px">
            <div style="padding:12px;border-radius:10px;border:1px solid rgba(2,8,23,0.06);display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">Cash on Delivery</div>
                <div style="color:#6b7280;font-size:13px">Pay in cash when the delivery arrives</div>
              </div>
              <div><button id="confirmCOD" class="btn btn-primary" style="background:var(--accent);color:#fff;">Confirm COD</button></div>
            </div>

            <div style="margin-top:12px;padding:12px;border-radius:10px;border:1px solid rgba(2,8,23,0.06);display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">Other payment methods</div>
                <div style="color:#6b7280;font-size:13px">UPI / Card / Netbanking (demo — mock flow)</div>
              </div>
              <div><button id="mockPay" class="btn btn-outline" style="background:#fff;">Proceed (demo)</button></div>
            </div>
          </div>

          <div style="margin-top:16px;color:#6b7280">Shipping to:</div>
          <div style="margin-top:8px;padding:12px;border-radius:8px;background:#f6f8fa;color:#082033">
            <div style="font-weight:700">${escapeXml(ord.shippingAddress.name)}</div>
            <div style="margin-top:6px">${escapeXml(ord.shippingAddress.address)}${ord.shippingAddress.landmark ? ', Landmark: ' + escapeXml(ord.shippingAddress.landmark) : ''}</div>
            <div style="margin-top:6px">${escapeXml(ord.shippingAddress.city)}, ${escapeXml(ord.shippingAddress.state)} - ${escapeXml(ord.shippingAddress.pin)}</div>
            <div style="margin-top:6px">${escapeXml(ord.shippingAddress.country)}</div>
            <div style="margin-top:6px">Phone: ${escapeXml(ord.shippingAddress.phone)}${ord.shippingAddress.altPhone ? ' • Alt: ' + escapeXml(ord.shippingAddress.altPhone) : ''}</div>
          </div>

          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:16px">
            <button id="backToOrders" class="btn btn-outline" style="background:#fff;">Back to orders</button>
          </div>
        </div>
      `;

      document.getElementById('backToOrders').addEventListener('click', () => location.hash = '/account/orders');

      document.getElementById('confirmCOD').addEventListener('click', () => {
        // update order payment status to COD confirmed
        const orders = loadOrders();
        const idx = orders.findIndex(o => o.id === orderId);
        if(idx === -1) return alert('Order not found');
        orders[idx].paymentStatus = 'COD';
        orders[idx].orderStatus = 'processing';
        saveOrders(orders);
        alert('COD confirmed. Order accepted.');
        location.hash = '/order-success/' + orderId;
      });

      document.getElementById('mockPay').addEventListener('click', () => {
        // simulate a successful payment (demo)
        const orders = loadOrders();
        const idx = orders.findIndex(o => o.id === orderId);
        if(idx === -1) return alert('Order not found');
        orders[idx].paymentStatus = 'paid (demo)';
        orders[idx].orderStatus = 'processing';
        saveOrders(orders);
        alert('Mock payment successful (demo).');
        location.hash = '/order-success/' + orderId;
      });
    }

    /* Order success page */
    function renderOrderSuccess(id){
      const mainArea = document.querySelector('.main-area');
      const orders = loadOrders();
      const ord = orders.find(o => o.id === id);
      mainArea.innerHTML = `<div style="background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface)"><h3>Order confirmed</h3><div style="margin-top:8px">Order id: <strong>${id}</strong></div><div style="margin-top:10px">Status: <strong>${ord ? ord.orderStatus : ''}</strong></div><div style="margin-top:10px">Payment: <strong>${ord ? ord.paymentStatus : ''}</strong></div><div style="margin-top:12px"><button style="background:#fff;border:1px solid rgba(2,8,23,0.06);padding:8px 12px;border-radius:8px;cursor:pointer" onclick="location.hash='/account/orders'">View my orders</button></div></div>`;
    }

    /* Admin (unchanged) */
    function renderAdmin(){
      const mainArea = document.querySelector('.main-area');
      const orders = loadOrders();
      mainArea.innerHTML = `
        <div style="background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface)">
          <h3>Admin panel (local demo)</h3>
          <div style="margin-top:8px;color:#6b7280">Orders stored in browser (local only)</div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <button id="exportOrders" class="btn btn-outline" style="background:#fff;">Export (console)</button>
            <button id="clearOrders" class="btn btn-outline" style="background:#fff;">Clear orders</button>
          </div>
          <div id="adminOrders" style="margin-top:12px;max-height:420px;overflow:auto"></div>
        </div>
      `;
      const list = document.getElementById('adminOrders');
      if(!orders.length) list.innerHTML = '<div style="color:#6b7280">No orders</div>';
      else orders.forEach(o => {
        const div = document.createElement('div');
        div.style.borderBottom = '1px solid rgba(2,8,23,0.04)';
        div.style.padding = '10px 0';
        div.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${o.id}</strong><div style="color:#6b7280;font-size:13px">${new Date(o.createdAt).toLocaleString()}</div></div><div>₹${o.total}</div></div><div style="margin-top:8px;color:#6b7280">${o.items.map(i=>i.title+' x'+i.qty).join(', ')}</div>`;
        list.appendChild(div);
      });
      document.getElementById('exportOrders').addEventListener('click', ()=>{ console.log('ORDERS EXPORT', loadOrders()); alert('Orders exported to console (demo).'); });
      document.getElementById('clearOrders').addEventListener('click', ()=>{ if(!confirm('Clear all orders (local)?')) return; saveOrders([]); renderAdmin(); });
    }

    /* Account page with My orders and cancel option */
    function renderAccount(sub = 'profile'){
      const mainArea = document.querySelector('.main-area');
      const profile = accountLoad();
      if(!profile){
        mainArea.innerHTML = `<div style="background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface)"><h3>Account</h3><div style="color:#6b7280;margin-top:8px">Not logged in. Login (demo) with phone.</div><div style="margin-top:12px"><button id="demoLogin" class="btn btn-primary" style="background:var(--accent);color:#fff;">Login (demo)</button></div></div>`;
        document.getElementById('demoLogin').addEventListener('click', openOtpLogin);
        return;
      }
      if(sub === 'profile'){
        mainArea.innerHTML = `<div style="background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface)"><h3>Personal details</h3><div style="display:flex;gap:12px"><div style="width:120px"><div style="width:120px;height:120px;border-radius:10px;overflow:hidden;background:#f6f8fa"><img id="profileAvatar" src="${profile.avatar || ''}" style="width:100%;height:100%;object-fit:cover" /></div><input id="avatarFile" type="file" accept="image/*" style="margin-top:8px" /></div><div style="flex:1"><label style="display:block">Full name<input id="profileName" value="${profile.name || ''}" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label><label style="display:block;margin-top:8px">Phone<input id="profilePhone" value="${profile.phone || ''}" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,8,23,0.06)" /></label><div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button id="saveProfile" class="btn btn-primary" style="background:var(--accent);color:#fff;">Save</button><button id="logoutProfile" class="btn btn-outline" style="background:#fff;">Logout</button></div></div></div></div>`;
        document.getElementById('avatarFile').addEventListener('change', (e) => {
          const f = e.target.files[0]; if(!f) return;
          const reader = new FileReader(); reader.onload = () => {
            const data = reader.result; document.getElementById('profileAvatar').src = data;
            const updated = { name: document.getElementById('profileName').value || profile.name, phone: document.getElementById('profilePhone').value || profile.phone, avatar: data };
            accountSave(updated);
          }; reader.readAsDataURL(f);
        });
        document.getElementById('saveProfile').addEventListener('click', () => {
          const name = document.getElementById('profileName').value.trim();
          const phone = document.getElementById('profilePhone').value.trim();
          if(!name || !phone) return alert('Name & phone required');
          const updated = { name, phone, avatar: (profile && profile.avatar) || '' };
          accountSave(updated); alert('Saved');
        });
        document.getElementById('logoutProfile').addEventListener('click', () => { accountLogout(); location.hash = '/'; });
        return;
      }

      if(sub === 'orders'){
        const orders = loadOrders();
        mainArea.innerHTML = `<div style="background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface)"><h3>My orders</h3><div id="ordersList" style="margin-top:12px"></div></div>`;
        const list = document.getElementById('ordersList');
        if(!orders.length) list.innerHTML = '<div style="color:#6b7280">No orders</div>';
        else orders.forEach(o => {
          const el = document.createElement('div');
          el.style.borderBottom = '1px solid rgba(2,8,23,0.04)';
          el.style.padding = '8px 0';
          el.innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <strong>${o.id}</strong>
                <div style="color:#6b7280;font-size:13px">${new Date(o.createdAt).toLocaleString()}</div>
                <div style="margin-top:6px;color:#6b7280;font-size:13px">${o.items.map(i=>i.title+' x'+i.qty).join(', ')}</div>
              </div>
              <div style="text-align:right">
                <div style="font-weight:800">₹${o.total}</div>
                <div style="color:#6b7280;font-size:13px">Status: ${o.orderStatus}</div>
                <div style="color:#6b7280;font-size:13px">Payment: ${o.paymentStatus}</div>
                <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end">
                  <button class="btn btn-outline" data-action="view" data-id="${o.id}" style="background:#fff;">View</button>
                  ${ (o.orderStatus !== 'cancelled' && o.orderStatus !== 'delivered') ? `<button class="btn btn-primary" data-action="cancel" data-id="${o.id}" style="background:#ff6b6b;border-color:rgba(2,8,23,0.06);">Cancel</button>` : '' }
                </div>
              </div>
            </div>
          `;
          list.appendChild(el);
        });

        // attach handlers for view and cancel
        list.querySelectorAll('button[data-action="view"]').forEach(b => b.addEventListener('click', () => {
          const id = b.getAttribute('data-id'); location.hash = '/order/' + id;
        }));
        list.querySelectorAll('button[data-action="cancel"]').forEach(b => b.addEventListener('click', () => {
          const id = b.getAttribute('data-id');
          if(!confirm('Cancel order ' + id + ' ?')) return;
          const orders = loadOrders();
          const idx = orders.findIndex(o => o.id === id);
          if(idx === -1) return alert('Order not found');
          orders[idx].orderStatus = 'cancelled';
          orders[idx].paymentStatus = 'refunded';
          saveOrders(orders);
          alert('Order cancelled');
          renderAccount('orders');
        }));
        return;
      }
    }

    /* Order detail view */
    function renderOrderDetail(id){
      const orders = loadOrders();
      const ord = orders.find(o => o.id === id);
      const mainArea = document.querySelector('.main-area');
      if(!ord){ mainArea.innerHTML = `<div style="padding:20px;color:#6b7280">Order not found</div>`; return; }
      mainArea.innerHTML = `
        <div style="background:var(--surface);padding:14px;border-radius:12px;color:var(--text-on-surface);max-width:900px;margin:0 auto">
          <h3>Order ${ord.id}</h3>
          <div style="margin-top:8px;color:#6b7280">${new Date(ord.createdAt).toLocaleString()}</div>
          <div style="margin-top:12px"><strong>Shipping</strong>
            <div style="color:#6b7280;margin-top:6px">${escapeXml(ord.shippingAddress.name)}, ${escapeXml(ord.shippingAddress.address)}</div>
            <div style="color:#6b7280;margin-top:6px">${escapeXml(ord.shippingAddress.city)}, ${escapeXml(ord.shippingAddress.state)} - ${escapeXml(ord.shippingAddress.pin)}</div>
            <div style="color:#6b7280;margin-top:6px">${escapeXml(ord.shippingAddress.country)}</div>
            <div style="color:#6b7280;margin-top:6px">Phone: ${escapeXml(ord.shippingAddress.phone)}${ord.shippingAddress.altPhone ? ' • Alt: ' + escapeXml(ord.shippingAddress.altPhone) : ''}</div>
          </div>
          <div style="margin-top:12px"><strong>Items</strong><div style="color:#6b7280;margin-top:6px">${ord.items.map(i=>i.title+' x'+i.qty).join('<br/>')}</div></div>
          <div style="margin-top:12px"><strong>Total</strong><div style="font-weight:800">₹${ord.total}</div></div>
          <div style="margin-top:12px;color:#6b7280">Status: <strong>${ord.orderStatus}</strong> • Payment: <strong>${ord.paymentStatus}</strong></div>
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            ${ (ord.orderStatus !== 'cancelled' && ord.orderStatus !== 'delivered') ? `<button id="cancelOrderBtn" class="btn btn-primary" style="background:#ff6b6b;border-color:rgba(2,8,23,0.06);">Cancel order</button>` : '' }
            <button id="backOrders" class="btn btn-outline" style="background:#fff;">Back</button>
          </div>
        </div>
      `;
      const cancelBtn = document.getElementById('cancelOrderBtn');
      if(cancelBtn){
        cancelBtn.addEventListener('click', () => {
          if(!confirm('Cancel this order?')) return;
          const orders = loadOrders();
          const idx = orders.findIndex(o => o.id === id);
          if(idx === -1) return alert('Order not found');
          orders[idx].orderStatus = 'cancelled';
          orders[idx].paymentStatus = 'refunded';
          saveOrders(orders);
          alert('Order cancelled');
          location.hash = '/account/orders';
        });
      }
      document.getElementById('backOrders').addEventListener('click', () => location.hash = '/account/orders');
    }

    /* Not found */
    function renderNotFound(){
      const mainArea = document.querySelector('.main-area');
      mainArea.innerHTML = `<div style="background:var(--surface);padding:24px;border-radius:12px;color:var(--text-on-surface)"><h3>Page not found</h3><div style="margin-top:12px"><button style="background:#fff;border:1px solid rgba(2,8,23,0.06);padding:8px 12px;border-radius:8px;cursor:pointer" onclick="location.hash='/'">Go home</button></div></div>`;
    }

    /* OTP login (demo) */
    function openOtpLogin(){
      const phone = prompt('Enter phone (demo)');
      if(!phone) return;
      alert('Mock OTP sent: 123456');
      const otp = prompt('Enter OTP (123456)');
      if(otp !== '123456') { alert('Wrong OTP'); return; }
      const profile = { name: 'User', phone, avatar: '' };
      accountSave(profile);
      location.hash = '/account/profile';
    }

    /* Boot sequence */
    (function boot(){
      loadProductsJsonSafe().then(() => {
        refreshAvatar();
        if(!location.hash) location.hash = '/';
        renderRoute();
      }).catch(() => {
        refreshAvatar();
        if(!location.hash) location.hash = '/';
        renderRoute();
      });
      window.addEventListener('hashchange', renderRoute);
    })();

    /* Delegated links handler */
    document.addEventListener('click', (e) => {
      const a = e.target.closest('[data-link]');
      if(!a) return;
      e.preventDefault();
      const link = a.getAttribute('data-link') || a.getAttribute('href') || '#/';
      if(link.startsWith('#')) location.hash = link.slice(1);
      else location.hash = link;
    });

    /* Search input wiring */
    (function wireSearch(){
      const input = document.getElementById('uxSearch');
      if(!input) return;
      input.addEventListener('keydown', (e) => {
        if(e.key === 'Enter'){
          const q = input.value.trim();
          location.hash = '/?q=' + encodeURIComponent(q);
        }
      });
    })();

    /* Admin quick open */
    document.getElementById('openAdminQuick').addEventListener('click', () => location.hash = '/admin');
    document.getElementById('uxShopNow').addEventListener('click', () => location.hash = '/');

    /* Expose a small debug API */
    window._debug = {
      loadCart, saveCart, loadOrders, saveOrders, accountLoad, accountSave, setProducts: (p) => { window.PRODUCTS = p; renderRoute(); }
    };
  </script>
</body>
</html>
```